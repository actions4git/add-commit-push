name: Test action
on:
  push:
    branches: "main"
    paths-ignore:
      - .gitignore
      - README.md
      - LICENSE
      - .github/**
      - "!.github/workflows/test-action.yml"
  pull_request:
    paths-ignore:
      - .gitignore
      - README.md
      - LICENSE
      - .github/**
      - "!.github/workflows/test-action.yml"
concurrency: ${{ github.workflow }}
jobs:
  branch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions4git/setup-git@v1
      - run: gh repo clone actions4git/add-commit-push-test .
        env:
          GITHUB_TOKEN: ${{ secrets.ADD_COMMIT_PUSH_TEST_TOKEN }}
      - run: echo '{"sha":"${{ github.sha }}"}' > branch.json
      - run: git add --all
      - run: git commit --message 'Trigger branch'
      - run: git push --force
  tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions4git/setup-git@v1
      - run: gh repo clone actions4git/add-commit-push-test .
        env:
          GITHUB_TOKEN: ${{ secrets.ADD_COMMIT_PUSH_TEST_TOKEN }}
      - run: echo '{"sha":"${{ github.sha }}"}' > tag.json
      - run: git add --all
      - run: git commit --message 'Trigger tag'
      - run: git tag --force tag
      - run: git push --force origin tag
  pull-request:
    runs-on: ubuntu-latest
    steps:
      - uses: actions4git/setup-git@v1
      - run: gh repo clone actions4git/add-commit-push-test .
        env:
          GITHUB_TOKEN: ${{ secrets.ADD_COMMIT_PUSH_TEST_TOKEN }}
      - run: echo '{"sha":"${{ github.sha }}"}' > pull-request.json
      - run: git add --all
      - run: git commit --message 'Trigger pull-request'
      - run: git push --force origin main:pull-request
  pull-request-fork:
    runs-on: ubuntu-latest
    steps:
      - uses: actions4git/setup-git@v1
      - run: gh repo clone actions4git/add-commit-push-test .
        env:
          GITHUB_TOKEN: ${{ secrets.ADD_COMMIT_PUSH_TEST_TOKEN }}
      - run: echo '{"sha":"${{ github.sha }}"}' > pull-request-fork.json
      - run: git add --all
      - run: git commit --message 'Trigger pull-request'
      - run: git push --force "https://x:$TOKEN@github.com/actions4git/add-commit-push-test-pull-request-fork" main
        env:
          TOKEN: ${{ secrets.ADD_COMMIT_PUSH_TEST_TOKEN }}
